dhtmlXGridObject.prototype.cO=function(c){if(c.update&&c.id!=0){if(this.bj[c.id].imgTag)this.bj[c.id].imgTag.src=this.eg+c.state+".gif";c.update= !1}};dhtmlXGridObject.prototype.doExpand=function(c){this.editStop();var a=c.parentNode.parentNode.parentNode,b=this._h2.get[a.idd];if(this.callEvent("onOpen",[a.idd,b.state=="plus"? -1:1]))b.state=="plus"?this.expandKids(a):b.state=="minus"&& !b._closeable&&this.collapseKids(a)};function dhtmlxHierarchy(){var c={id:0,bu:[],gR: -1,parent:null,index:0,state:dhtmlXGridObject._emptyLineImg};this.order=[c];this.get={0:c};this.swap=function(a,b){var c=a.parent,e=a.index;c.bu[e]=b;c.bu[b.index]=a;a.index=b.index;b.index=e};this.forEachChildF=function(a,b,c,e){for(var f=this.get[a],g=0;g<f.bu.length;g++)if(b.apply(c||this,[f.bu[g]]))f.bu[g].bu.length&&this.forEachChildF(f.bu[g].id,b,c,e),e&&e.call(c||this,f.bu[g])};this.so=function(a,b,c){for(var e=this.get[a],f=0;f<e.bu.length;f++)b.apply(c||this,[e.bu[f]]),e.bu[f].bu.length&&this.so(e.bu[f].id,b,c)};this.JA=function(a,b,c){var e=this.get[a];if(e[b]!=c)e[b]=c,e.update= !0};this.add=function(a,b){return this.addAfter(a,b)};this.addAfter=function(a,b,c,e){var f=this.get[b||0],g=c?this.get[c].index+(e?0:1):f.bu.length,h={id:a,bu:[],gR:f.gR+1,parent:f,index:g,state:dhtmlXGridObject._emptyLineImg};f.state==dhtmlXGridObject._emptyLineImg&&this.JA(b,"state",b==0?"minus":"plus");if(c){for(var i=g;i<f.bu.length;i++)f.bu[i].index++;f.bu=f.bu.slice(0,g).concat([h]).concat(f.bu.slice(g,f.bu.length))}else f.bu.push(h);return this.get[a]=h};this.addBefore=function(a,b,c){return this.addAfter(a,b,c,!0)};this.remove=function(a){for(var b=this.get[a||0],c=0;c<b.bu.length;c++)this.deleteAll(b.bu[c].id);b.bu=[];b.parent.bu=b.parent.bu.slice(0,b.index).concat(b.parent.bu.slice(b.index+1));for(c=b.index;c<b.parent.bu.length;c++)b.parent.bu[c].index--;delete this.get[a]};this.deleteAll=function(a){for(var b=this.get[a||0],c=0;c<b.bu.length;c++)this.deleteAll(b.bu[c].id);b.bu=[];delete this.get[a]};return this}dhtmlXGridObject.prototype._getOpenLenght=function(c,a){var b=this._h2.get[c].bu;a+=b.length;for(var d=0;d<b.length;d++)b[d].bu.length&&b[d].state=="minus"&&(a+=this._getOpenLenght(b[d].id,0));return a};dhtmlXGridObject.prototype.collapseKids=function(c){var a=this._h2.get[c.idd];if(a.state=="minus"&&this.callEvent("onOpenStart",[c.idd,1])){var b=c.rowIndex;b<0&&(b=this.am.bP(c)+1);this._h2.JA(a.id,"state","plus");this.cO(a);if(this.ahK||this.aW)this._h2_to_buff(),this.uR();else{for(var d=this._getOpenLenght(this.am[b-1].idd,0),e=0;e<d;e++)this.am[b+e].parentNode.removeChild(this.am[b+e]);this.am.splice(b,d)}this.callEvent("onGridReconstructed",[]);this.setSizes();this._h2_to_buff();this.callEvent("onOpenEnd",[c.idd,-1])}};dhtmlXGridObject.prototype._massInsert=function(c,a,b){var d=[],e=cn?this.obj:this.obj.rows[0].parentNode;this._h2_to_buff();if(this.ahK||this.aW)return this.uR();for(var f=this._getOpenLenght(c.id,0),g=0;g<f;g++){var h=this.render_row(b+g);a?a.parentNode.insertBefore(h,a):e.appendChild(h);d.push(h)}this.am=dhtmlxArray(this.am.slice(0,b).concat(d).concat(this.am.slice(b)));return c.bu.length+d.length};dhtmlXGridObject.prototype.expandKids=function(c,a){var b=this._h2.get[c.idd];if(b.bu.length||b._xml_await)if(b.state=="plus"&&(b._loading||a||this.callEvent("onOpenStart",[b.id,-1]))){var d=this.getRowIndex(b.id)+1;if(b.bu.length){b._loading= !1;this._h2.JA(b.id,"state","minus");this.cO(b);var e=this._massInsert(b,this.am[d],d);this.callEvent("onGridReconstructed",[])}else if(b._xml_await)b._loading= !0,this.callEvent("onDynXLS",[b.id])&&this.load(this.kidsXmlFile+""+(this.kidsXmlFile.indexOf("?")!= -1?"&":"?")+"id="+b.id,this._data_type);this.setSizes();b._loading||this.callEvent("onOpenEnd",[b.id,1]);this._fixAlterCss()}};dhtmlXGridObject.prototype.kidsXmlFile="";dhtmlXGridObject.prototype.sT=function(c,a,b){var d="getValue";this.adH({parentNode:{grid:this}},this.abv(c)).getDate&&(d="getDate",a="str");this.forEachRow(function(b){var e=this._h2.get[b];if(e){var f=this._get_cell_value(e.buff,c,d);a=="int"?(e._sort=parseFloat(f),e._sort=isNaN(e._sort)? -99999999999999:e._sort):e._sort=f}});var e=this,f=1,g= -1;b=="des"&&(f= -1,g=1);var h=null;a=="cus"&&(h=function(a,d){return e._customSorts[c](a._sort,d._sort,b,a.id,d.id)});a=="str"&&(h=function(a,b){return a._sort<b._sort?g:a._sort==b._sort?0:f});a=="int"&&(h=function(a,b){return a._sort<b._sort?g:a._sort==b._sort?0:f});a=="date"&&(h=function(a,b){return(Date.parse(new Date(a._sort||"01/01/1900"))-Date.parse(new Date(b._sort||"01/01/1900")))*f});this._sortTreeRows(h,0);this.uR(0,!0);this.callEvent("onGridReconstructed",[])};dhtmlXGridObject.prototype._sortTreeRows=function(c,a){var b=this._h2.get[a].bu;this.am.stablesort?this.am.stablesort.call(b,c):b.sort(c);for(var d=0;d<b.length;d++)b[d].bu.length&&this._sortTreeRows(c,b[d].id),b[d].index=d};dhtmlXGridObject.prototype.uR=function(){this._h2_to_buff();var c=this.HF.scrollTop;this._reset_view();this.HF.scrollTop=c};dhtmlXGridObject.prototype.ahx=function(){this.nh||this._h2.so(0,function(c){if(c.buff.tagName=="TR"){var a=(this.Cw?c.gR%2:c.index%2)?this.iI:this.hC;this.bj[c.id].className=a+(this.Vh?" "+a+"_"+c.gR:"")+" "+(this.bj[c.id].Vn||"")+(this.bj[c.id].className.indexOf("rowselected")!= -1?" rowselected":"")}},this)};dhtmlXGridObject.prototype.MN=function(c,a){var b=this._h2.get[c],d=b.parent.bu[b.index+a];if(d&&d.parent==b.parent){var e=[b.state,d.state];this.collapseKids(this.bj[b.id]);this.collapseKids(this.bj[d.id]);var f=this.am.bP(this.bj[c]),g=this.aD.bP(this.bj[c]),h=this.obj.rows[0].parentNode.removeChild(this.am[f]),i=this.am[f+(a==1?2:a)];i?i.parentNode.insertBefore(h,i):this.obj.rows[0].parentNode.appendChild(h);this.am.yk(f,f+a);this.aD.yk(g,g+a);this._h2.swap(d,b);e[0]=="minus"&&this.expandKids(this.bj[b.id]);e[1]=="minus"&&this.expandKids(this.bj[d.id]);this._fixAlterCss(Math.min(f,f+a))}};function eXcell_tree(c){if(c)this.cell=c,this.grid=this.cell.parentNode.grid;this.isDisabled=function(){return this.cell._disabled||this.grid._edtc};this.edit=function(){if(!this.er&& !this.grid._edtc){this.er=this.cell.parentNode.JT;this.val=this.DB();this.cell.CZ= !this.grid.hu&&(cn||gP||aq)?"INPUT":"TEXTAREA";this.er.innerHTML="<"+this.cell.CZ+" class='dhx_combo_edit' type='text' style='height:"+(this.cell.offsetHeight-6)+"px; width:100%; border:0px; margin:0px; padding:0px; padding-top:"+(aq?1:2)+"px; overflow:hidden;'></"+this.cell.CZ+">";this.er.childNodes[0].onmousedown=function(a){(a||event).cancelBubble= !0};this.er.childNodes[0].onselectstart=function(a){a||(a=event);return a.cancelBubble= !0};if(aq)this.er.style.top="1px";this.er.className+=" editable";this.er.firstChild.onclick=function(a){(a||event).cancelBubble= !0};this.er.firstChild.value=this.val;this.obj=this.er.firstChild;this.er.firstChild.style.width=Math.max(0,this.cell.offsetWidth-this.er.offsetLeft)+"px";this.er.firstChild.focus();_isIE&&this.er.firstChild.focus()}};this.detach=function(){if(this.er){this.setLabel(this.er.firstChild.value);this.er.className=this.er.className.replace("editable","");var a=this.val!=this.er.innerHTML;if(aq)this.er.style.top="2px";this.obj=this.er=null;return a}};this.getValue=function(){return this.DB()};this.hW=function(a){this.cell.parentNode.imgTag.nextSibling.src=this.grid.iconURL+a;this.grid._h2.get[this.cell.parentNode.idd].image=a};this.getImage=function(){};this.setLabel=function(a){this.setValueA(a)};this.DB=function(){return this.cell.parentNode.JT.innerHTML}}eXcell_tree.prototype=new gD;eXcell_tree.prototype.setValueA=function(c){this.cell.parentNode.JT.innerHTML=c;this.grid.callEvent("onCellChanged",[this.cell.parentNode.idd,this.cell._cellIndex,c])};eXcell_tree.prototype.setValue=function(c){if(this.cell.parentNode.imgTag)return this.setLabel(c);if(this.grid.kj.eg==null||this.grid.kj.eg!=this.grid.eg){var a={};a.spacer="<img src='"+this.grid.eg+"blank.gif'  align='absmiddle' class='space'>";a.imst="<img src='"+this.grid.eg;a.imsti="<img src='"+(this.grid.iconURL||this.grid.eg);a.imact="' align='absmiddle'  onclick='this."+(cn?"":"parentNode.")+"parentNode.parentNode.parentNode.parentNode.grid.doExpand(this);event.cancelBubble=true;'>";a.plus=a.imst+"plus.gif"+a.imact;a.minus=a.imst+"minus.gif"+a.imact;a.blank=a.imst+"blank.gif"+a.imact;a.start="<div class='treegrid_cell' style='overflow:hidden; white-space : nowrap; height:"+(_isIE?20:18)+"px;'>";a.itemim="' align='absmiddle' "+(this.grid._img_height?' height="'+this.grid._img_height+'"':"")+(this.grid._img_width?' width="'+this.grid._img_width+'"':"")+" ><span "+(aq||cU?"style='position:relative; top:2px;'":"")+"id='nodeval'>";a.close="</span></div>";this.grid.kj=a}var a=this.grid.kj,b=this.cell.parentNode.idd,d=this.grid._h2.get[b];if(this.grid.kidsXmlFile||this.grid.mI)d.has_kids=d.has_kids||this.cell.parentNode._attrs.xmlkids&&d.state!="minus",d._xml_await= ! !d.has_kids;d.image=d.image||this.cell._attrs.image||"leaf.gif";d.label=c;for(var e=[a.start],f=0;f<d.gR;f++)e.push(a.spacer);d.has_kids?(e.push(a.plus),d.state="plus"):e.push(a.imst+d.state+".gif"+a.imact);e.push(a.imsti);e.push(d.image);e.push(a.itemim);e.push(d.label);e.push(a.close);this.cell.innerHTML=e.join("");this.cell._treeCell= !0;this.cell.parentNode.imgTag=this.cell.childNodes[0].childNodes[d.gR];this.cell.parentNode.JT=this.cell.childNodes[0].childNodes[d.gR+2];if(cn)this.cell.vAlign="top";if(d.parent.id!=0&&d.parent.state=="plus")this.grid.cO(d.parent,!1),this.cell.parentNode.WX= !0;this.grid.callEvent("onCellChanged",[b,this.cell._cellIndex,c])};dhtmlXGridObject.prototype._process_tree_xml=function(c,a,b){this._parsing= !0;var d= !1;if(!a){this.render_row=this.render_row_tree;d= !0;a=c.cR(this.xml.top);b=a.getAttribute("parent")||0;b=="0"&&(b=0);if(!this._h2)this._h2=new dhtmlxHierarchy;if(this.aC)this.aC._h2=this._h2}var e=c.et(this.xml.row,a);this._open=this._open||[];for(var f=0;f<e.length;f++){var g=e[f].getAttribute("id");g||(g=this.uid(),e[f].setAttribute("id",g));var h=this._h2.add(g,b);h.buff={idd:g,data:e[f],_parser:this._process_xml_row,_locator:this._get_xml_data};if(e[f].getAttribute("open"))h.state="minus",this._open.push(g);this.bj[g]=h.buff;this._process_tree_xml(c,e[f],g)}if(d){e.length?b!=0&& !this.ahK&&this._h2.JA(b,"state","minus"):this._h2.JA(b,"state",dhtmlXGridObject._emptyLineImg);for(f=0;f<this._open.length;f++){var i=this._h2.get[this._open[f]];if(!i.bu.length)i.state=dhtmlXGridObject._emptyLineImg}this.cO(this._h2.get[b]);this._h2_to_buff();b!=0&&this.ahK?this.hx(b):this.aW?this.uR():this.render_dataset();if(this.kidsXmlFile)for(f=0;f<this._open.length;f++)i=this._h2.get[this._open[f]],i._xml_await&&this.expandKids({idd:i.id});this._open=[];this.mI=== !1&&this.forEachRow(function(a){this.render_row_tree(0,a)});this._parsing= !1;b!=0&& !this.ahK&&this.callEvent("onOpenEnd",[b,1])}return c.ai.responseXML?c.ai.responseXML:c.ai};dhtmlXGridObject.prototype._h2_to_buff=function(c){if(!c&&(c=this._h2.get[0],this.aD=new dhtmlxArray,this.aC&& !this.nh))this.aC.aD=this.aD;for(var a=0;a<c.bu.length;a++)this.aD.push(c.bu[a].buff),c.bu[a].state=="minus"&&this._h2_to_buff(c.bu[a])};dhtmlXGridObject.prototype.render_row_tree=function(c,a){if(a)var b=this._h2.get[a],b=b?b.buff:b;else b=this.aD[c];if(!b)return-1;if(b._parser){if(this.bj[b.idd]&&this.bj[b.idd].tagName=="TR")return this._h2.get[b.idd].buff=this.aD[c]=this.bj[b.idd];var d=this.uO(b.idd);this.bj[b.idd]=d;a||(this.aD[c]=d);this._h2.get[b.idd].buff=d;b._parser.call(this,d,b.data);this.jQ(d);return d}return b};dhtmlXGridObject.prototype.yE=function(c,a){if(a)this._h2.so(a.id,function(a){this.yE(null,a);delete this.bj[a.id]},this);else{var b=this.getRowIndex(c.idd),a=this._h2.get[c.idd];if(b!= -1&&b!==this.undefined){var d=1;a&&a.state=="minus"&&(d+=this._getOpenLenght(a.id,0));for(var e=0;e<d;e++)this.am[e+b]&&this.am[e+b].parentNode.removeChild(this.am[e+b]);if(this.aC){for(e=0;e<d;e++)this.aC.am[e+b]&&this.aC.am[e+b].parentNode.removeChild(this.aC.am[e+b]);d>1&&this.aC.am.splice(b+1,d-1)}this.am.splice(b,d);this.aD.splice(b,d)}a&&(this.yE(null,a),delete this.bj[a.id],a.parent.bu.length==1&&(this._h2.JA(a.parent.id,"state",dhtmlXGridObject._emptyLineImg),this.cO(a.parent)),this._h2.remove(a.id))}};dhtmlXGridObject.prototype.hx=function(c){var a=this._h2.get[c||0],b=this.dz(c||0);b&&(a.parent&&a.parent.id!=0&&this.hx(a.parent.id),this.expandKids(b))};dhtmlXGridObject.prototype._addRowClassic=dhtmlXGridObject.prototype.hY;dhtmlXGridObject.prototype.hY=function(c,a,b,d,e,f){if(!this._h2)return this._addRowClassic(c,a,b);var d=d||0,g=this.cellType.bP("tree");typeof a=="string"&&(a=a.split(this.gX));var h=this._h2.get[c];if(!h)d==0?b=this.aD.length:(b=this.getRowIndex(d)+1,this._h2.get[d].state=="minus"?b+=this._getOpenLenght(d,0):this.WX= !0);h=h||this._h2.add(c,d);h.image=e;h.has_kids=f;return h.buff=this._addRowClassic(c,a,b)};dhtmlXGridObject.prototype.addRowBefore=function(c,a,b,d,e){var f=this.bj[b];if(f){if(!this._h2)return this.hY(c,a,this.getRowIndex(b));var g=this._h2.get[b].parent.id,h=this.getRowIndex(b);if(h== -1)this.WX= !0;this._h2.addBefore(c,g,b);return this.hY(c,a,h,this._h2.get[b].parent.id,d,e)}};dhtmlXGridObject.prototype.addRowAfter=function(c,a,b,d,e){var f=this.bj[b];if(f){if(!this._h2)return this.hY(c,a,this.getRowIndex(b)+1);var g=this._h2.get[b].parent.id,h=this.getRowIndex(b);if(h== -1)this.WX= !0;this._h2.get[b].state=="minus"?h+=this._getOpenLenght(b,0)+1:h++;this._h2.addAfter(c,g,b);return this.hY(c,a,h,g,d,e)}};dhtmlXGridObject.prototype.enableSmartXMLParsing=function(c){this.mI=ap(c)};dhtmlXGridObject.prototype.DF=function(c,a,b){var d=this.cellType.bP("tree");for(i=0;i<c.cells.length;i++)i!=d?this.cells(b,i).setValue(this.cells(a,i).getValue()):this.cells(b,i).setValueA(this.cells(a,i).getValue())};dhtmlXGridObject.prototype.KW=function(c){var a=this.dz(c);a&&this.collapseKids(a)};dhtmlXGridObject.prototype.cx=function(c){var a=this._h2.get[c];if(a)for(;a.bu.length;)this.deleteRow(a.bu[0].id)};dhtmlXGridObject.prototype.Fx=function(c){var a=[],b=this._h2.get[c||0];if(b)for(var d=0;d<b.bu.length;d++)a.push(b.bu[d].id),b.bu[d].bu.length&&(a=a.concat(this.Fx(b.bu[d].id).split(this.gX)));return a.join(this.gX)};dhtmlXGridObject.prototype.getChildItemIdByIndex=function(c,a){var b=this._h2.get[c||0];return!b?null:b.bu[a]?b.bu[a].id:null};dhtmlXGridObject.prototype.getItemText=function(c){return this.cells(c,this.cellType.bP("tree")).DB()};dhtmlXGridObject.prototype.getOpenState=function(c){var a=this._h2.get[c||0];if(a)return a.state=="minus"? !0: !1};dhtmlXGridObject.prototype.getParentId=function(c){var a=this._h2.get[c||0];return!a|| !a.parent?null:a.parent.id};dhtmlXGridObject.prototype.Mn=function(c){var a=[],b=this._h2.get[c||0];if(b)for(var d=0;d<b.bu.length;d++)a.push(b.bu[d].id);return a.join(this.gX)};dhtmlXGridObject.prototype.expandAll=function(c){this._renderAllExpand(c||0);this._h2_to_buff();this._reset_view();this.setSizes();this.callEvent("onGridReconstructed",[]);this._redrawLines&&this._redrawLines()};dhtmlXGridObject.prototype._renderAllExpand=function(c){for(var a=this._h2.get[c].bu,b=0;b<a.length;b++)a[b].bu.length&&(this._h2.JA(a[b].id,"state","minus"),this.cO(a[b]),this._renderAllExpand(a[b].id))};dhtmlXGridObject.prototype.collapseAll=function(c){this._h2.so(c||0,function(a){if(a&&a.state=="minus")a.state="plus",a.update= !0,this.cO(a)},this);this._h2_to_buff();this._reset_view();this.setSizes();this.callEvent("onGridReconstructed",[]);this._redrawLines&&this._redrawLines()};dhtmlXGridObject.prototype.hasChildren=function(c){var a=this._h2.get[c];return a&&a.bu.length?a.bu.length:a._xml_await? -1:0};dhtmlXGridObject.prototype.setItemCloseable=function(c,a){var b=this._h2.get[c];if(b)b._closeable= !ap(a)};dhtmlXGridObject.prototype.setItemText=function(c,a){return this.cells(c,this.cellType.bP("tree")).setLabel(a)};dhtmlXGridObject.prototype.setItemImage=function(c,a){this._h2.get[c].image=a;this.bj[c].imgTag.nextSibling.src=(this.iconURL||"")+a};dhtmlXGridObject.prototype.getItemImage=function(c){this.dz(c);return this._h2.get[c].image};dhtmlXGridObject.prototype.setImageSize=function(c,a){this._img_width=c;this._img_height=a};dhtmlXGridObject.prototype._getRowImage=function(c){return this._h2.get[c.idd].image};dhtmlXGridObject.prototype.setOnOpenStartHandler=function(c){this.attachEvent("onOpenStart",c)};dhtmlXGridObject.prototype.setOnOpenEndHandler=function(c){this.attachEvent("onOpenEnd",c)};dhtmlXGridObject.prototype.enableTreeCellEdit=function(c){this._edtc= !ap(c)};dhtmlXGridObject.prototype.sS=function(c){var a=this._h2.get[c||0];return!a? -1:a.gR};dhtmlXGridObject.prototype.oj=function(c,a){for(i in this.bj)if(this.bj[i]&&this.bj[i].childNodes)this.bj[i].childNodes[c].style.display=a};dhtmlXGridObject._emptyLineImg="blank";